<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.gd.orh.mapper.PassengerRatingMapper" >
  <resultMap id="UserResult" type="User">
    <id column="USER_ID" property="id"/>
    <result column="NICKNAME" property="nickname"/>
  </resultMap>

  <resultMap id="PassengerResult" type="Passenger">
    <id column="PASSENGER_ID" property="id"/>
    <association property="user" resultMap="UserResult"/>
  </resultMap>

  <resultMap id="PassengerRatingResult" type="PassengerRating">
    <id column="PASSENGER_RATING_ID" property="id"/>
    <result column="RATING_SCORE" property="ratingScore"/>
    <result column="TRIP_ORDER_ID" property="tripOrderId"/>
    <association property="passenger" resultMap="PassengerResult"/>
  </resultMap>

  <insert id="insertPassengerRating" parameterType="PassengerRating" useGeneratedKeys="true" keyProperty="id">
    INSERT INTO PASSENGER_RATING (RATING_SCORE,PASSENGER_ID,TRIP_ORDER_ID)
    VALUES (#{ratingScore},#{passenger.id},#{tripOrderId})
  </insert>

  <select id="findById" resultMap="PassengerRatingResult">
    SELECT
      PR.ID PASSENGER_RATING_ID,RATING_SCORE,TRIP_ORDER_ID,
      P.ID PASSENGER_ID,
      U.ID USER_ID,NICKNAME
    FROM PASSENGER_RATING PR
      LEFT OUTER JOIN PASSENGER P ON PR.PASSENGER_ID=P.ID
      LEFT JOIN USER U ON P.USER_ID=U.ID
  </select>
</mapper>